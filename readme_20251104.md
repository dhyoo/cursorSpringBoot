# Spring Boot 프로젝트 구축 가이드 (Cursor AI 활용)

이 문서는 Cursor AI를 활용하여 Spring Boot 프로젝트를 구축한 과정을 정리한 것입니다.

## 프로젝트 개요

- **프로젝트명**: cursorSpringBoot
- **Java 버전**: OpenJDK 21 LTS
- **Spring Boot 버전**: 3.2.5
- **빌드 도구**: Gradle
- **데이터베이스**: H2 (인메모리)
- **API 문서화**: Swagger/OpenAPI (springdoc-openapi 2.3.0)

## 개발 과정

### 1. 환경 설정

#### Java 설치
- OpenJDK 21 LTS를 `C:\java`에 설치
- `JAVA_HOME` 환경 변수 설정: `C:\java\jdk-21.0.7+6`
- `PATH`에 `%JAVA_HOME%\bin` 추가

#### 프로젝트 구조
- 기존 Spring Boot 프로젝트 활용
- `build.gradle`에서 Java 버전을 21로 설정

### 2. 기본 API 구현

#### Hello World 컨트롤러
- `/hello` 및 `/` 엔드포인트 추가
- 간단한 REST API 테스트

### 3. Swagger UI 설정

#### 의존성 추가
```gradle
implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.3.0'
```

#### Swagger 설정
- `SwaggerConfig.java` 생성: API 문서 메타데이터 설정
- `SecurityConfig.java` 생성: Swagger UI 접근 허용 (OAuth2 비활성화)
- `application.yaml`에 Swagger 설정 추가

#### 전역 API 응답 설정
- `OperationCustomizer`를 사용하여 모든 API에 자동으로 400, 404, 500 응답 추가
- 각 컨트롤러마다 개별 설정 불필요

### 4. React 프론트엔드 분석 및 API 설계

#### 분석 대상
- `C:\project\my-app` 폴더의 React 프로젝트 구조 분석
- 프론트엔드에서 필요한 API 엔드포인트 파악

#### 구현된 API
1. **Menu API** (`/api/menus`)
   - 계층형 메뉴 구조 지원
   - 권한 기반 메뉴 필터링

2. **User API** (`/api/users`)
   - CRUD 작업 지원
   - 사용자 목록, 조회, 생성, 수정, 삭제

3. **Role API** (`/api/roles`)
   - 역할(권한) 관리
   - CRUD 작업 지원

4. **Board API** (`/api/boards`)
   - 게시판 기능
   - 카테고리 필터링 지원
   - 조회수 자동 증가

5. **Activity API** (`/api/activities`)
   - 활동 로그 조회

6. **Dashboard API** (`/api/dashboard/stats`)
   - 대시보드 통계 정보

### 5. 데이터베이스 통합

#### 초기 구현: Mock 데이터
- 서비스 레이어에서 하드코딩된 데이터 반환
- 빠른 프로토타이핑 목적

#### JPA Entity 및 Repository로 전환
- **Entity 생성**: User, Role, Board, Menu, Activity
- **Repository 생성**: 각 Entity에 대한 JPA Repository
- **EntityMapper**: Entity ↔ DTO 변환 로직
- **DataInitializer**: 애플리케이션 시작 시 샘플 데이터 자동 생성

#### H2 데이터베이스
- 인메모리 데이터베이스 사용
- H2 Console 활성화: `http://localhost:8080/h2-console`

### 6. 예외 처리

#### 전역 예외 처리
- `GlobalExceptionHandler` 구현
- `@RestControllerAdvice` 사용
- `ResourceNotFoundException`: 404 응답
- `BadRequestException`: 400 응답
- `MethodArgumentNotValidException`: 검증 오류 처리

#### 공통 API 응답
- `ApiResponse<T>` 클래스로 통일된 응답 형식
- 성공/실패 여부, 데이터, 메시지, 타임스탬프 포함

### 7. CORS 설정

#### CorsConfig
- React 프론트엔드와의 통신을 위한 CORS 설정
- 허용된 Origin:
  - `http://localhost:3000`
  - `http://localhost:5173`
  - `http://localhost:5174`
  - `http://127.0.0.1:3000`
  - `http://127.0.0.1:5173`

### 8. 한글 인코딩 문제 해결

#### 문제점
- 로그에 한글이 깨져서 표시됨
- API 응답의 한글도 깨짐

#### 해결 방법
1. **build.gradle**
   - `bootRun` 태스크에 JVM 인코딩 인자 추가
   - `compileJava`, `compileTestJava`에 UTF-8 인코딩 설정

2. **application.yaml**
   - `server.servlet.encoding` 설정
   - `logging.charset` 설정

3. **logback-spring.xml**
   - Console 및 File appender에 UTF-8 인코딩 설정

## 프로젝트 구조

```
src/main/java/com/example/demo/
├── config/
│   ├── SwaggerConfig.java          # Swagger 설정
│   ├── SecurityConfig.java          # Spring Security 설정
│   ├── CorsConfig.java              # CORS 설정
│   └── DataInitializer.java         # 초기 데이터 설정
├── controller/
│   ├── MenuController.java
│   ├── UserController.java
│   ├── RoleController.java
│   ├── BoardController.java
│   ├── ActivityController.java
│   └── DashboardController.java
├── service/
│   ├── MenuService.java
│   ├── UserService.java
│   ├── RoleService.java
│   ├── BoardService.java
│   ├── ActivityService.java
│   └── DashboardService.java
├── entity/
│   ├── User.java
│   ├── Role.java
│   ├── Board.java
│   ├── Menu.java
│   └── Activity.java
├── repository/
│   ├── UserRepository.java
│   ├── RoleRepository.java
│   ├── BoardRepository.java
│   ├── MenuRepository.java
│   └── ActivityRepository.java
├── dto/
│   ├── ApiResponse.java
│   ├── UserDto.java
│   ├── RoleDto.java
│   ├── BoardDto.java
│   ├── MenuItem.java
│   ├── MenuResponse.java
│   ├── ActivityDto.java
│   └── DashboardStatsDto.java
├── mapper/
│   └── EntityMapper.java            # Entity ↔ DTO 변환
└── exception/
    ├── ResourceNotFoundException.java
    ├── BadRequestException.java
    └── GlobalExceptionHandler.java
```

## 주요 기능

### 1. RESTful API
- 표준 REST API 설계
- HTTP 메서드 적절히 활용 (GET, POST, PUT, DELETE)

### 2. API 문서화
- Swagger UI 자동 생성
- 접근 경로: `http://localhost:8080/swagger-ui/index.html`
- 모든 API에 대한 상세 문서 제공

### 3. 전역 예외 처리
- 중앙 집중식 예외 처리
- 일관된 오류 응답 형식

### 4. 데이터베이스
- JPA를 통한 객체-관계 매핑
- H2 인메모리 데이터베이스 (개발 환경)
- 자동 스키마 생성 및 데이터 초기화

## 실행 방법

### 1. 환경 변수 설정
```powershell
$env:JAVA_HOME = "C:\java\jdk-21.0.7+6"
$env:Path = "C:\java\jdk-21.0.7+6\bin;" + $env:Path
```

### 2. 빌드
```bash
.\gradlew.bat clean build
```

### 3. 실행
```bash
.\gradlew.bat bootRun
```

### 4. 접속
- 애플리케이션: `http://localhost:8080`
- Swagger UI: `http://localhost:8080/swagger-ui/index.html`
- H2 Console: `http://localhost:8080/h2-console`

## Cursor AI 활용 팁

### 1. 점진적 개발
- 작은 기능부터 시작하여 점진적으로 확장
- Mock 데이터로 시작하여 실제 DB로 전환

### 2. 문제 해결
- 에러 메시지를 정확히 전달하면 빠른 해결 가능
- 컨텍스트 정보 제공 (파일 경로, 에러 로그 등)

### 3. 코드 일관성
- 기존 코드 스타일 유지
- 패턴 일관성 확보 (DTO, Entity, Service 구조)

### 4. 설정 관리
- 설정 파일(`application.yaml`, `build.gradle`) 변경 시 주의
- 환경별 설정 분리 고려

## 주요 해결 사항

1. **Swagger UI 로그인 페이지 리다이렉트**
   - Spring Security 설정으로 해결
   - Swagger UI 경로에 대한 접근 허용

2. **SQL 예약어 충돌**
   - `Activity` 엔티티의 `user` 필드를 `user_name` 컬럼으로 매핑

3. **한글 인코딩 문제**
   - JVM, 서블릿, 로깅 설정 전반에 UTF-8 적용

4. **공통 API 응답 설정**
   - `OperationCustomizer`를 사용한 전역 설정
   - 각 컨트롤러별 개별 설정 제거

## 다음 단계

- [ ] 프로덕션 데이터베이스 연동 (PostgreSQL, MySQL 등)
- [ ] 인증/인가 시스템 구현
- [ ] 단위 테스트 및 통합 테스트 작성
- [ ] 로깅 시스템 고도화
- [ ] API 버저닝 전략 수립

## 개발 대화 요약

### 초기 설정 단계

**사용자**: "jdk를 설치 하고 싶은데 open jdk를 C 드라이브 밑에 java 폴더 아래 설치해주고 설치 후에 PATH 설정도 잡아줘"
- OpenJDK 21 LTS 설치 및 환경 변수 설정
- PowerShell을 통한 자동 설치 및 PATH 설정

**사용자**: "그럼 이 프로젝트를 실행시켜줘"
- Gradle 빌드 및 실행
- Java 버전 불일치 문제 발견 및 해결 (17 → 21)

**사용자**: "Hellow world 찍어줘"
- HelloController 생성 (`/hello`, `/` 엔드포인트)

### Swagger UI 설정

**사용자**: "이 화면이 안나타나"
- Swagger UI 접근 문제 확인

**사용자**: "http://localhost:8080/swagger-ui/index.html 를 호출하니 http://localhost:8080/login 이 페이지로 넘어가"
- Spring Security의 OAuth2 설정으로 인한 리다이렉트 문제 발견
- SecurityConfig 생성하여 Swagger UI 및 API 경로 접근 허용

### API 개발 단계

**사용자**: "C:\project\my-app 폴더의 ract 구조에 맞는 API를 설정을 할꺼야 해당 파일을 분석해서 데이터를 만들어줘 현재 DB가 없기 때문에 mockup 데이터로 불러오는 구조로 만들어 주고 그리고 tomcat을 설치하고 마지막에 스웨거로 api를 보여줘 모든 설치 데이터는 안정적인 버전으로 설치해줘"
- React 프로젝트 구조 분석 (`C:\project\my-app`)
- 프론트엔드에서 필요한 API 엔드포인트 파악
- Mock 데이터 기반 Service 구현
- Menu, User, Role, Board, Activity, Dashboard API 생성
- Swagger 설정 완료

**사용자**: "좋아 해당건을 기반으로 JAP 데이터 및 엔티티들을 생성해줘 DB연결을 못하니 샘플 데이터는 따로 만들어줘"
- Mock 데이터에서 JPA Entity/Repository로 전환
- H2 인메모리 데이터베이스 설정
- Entity, Repository, EntityMapper 생성
- DataInitializer를 통한 샘플 데이터 자동 생성

### 문제 해결 과정

**사용자**: "컴파일 에러 확인해줘"
- Lombok 어노테이션 충돌 해결
- Swagger 어노테이션 이름 충돌 해결 (`@ApiResponse` → `@io.swagger.v3.oas.annotations.responses.ApiResponse`)
- 중복 파일 삭제

**사용자**: "실행중 오류 발생함"
- SQL 예약어 충돌: `Activity` 엔티티의 `user` 필드를 `user_name` 컬럼으로 매핑
- `@Column(name = "user_name")` 추가

**사용자**: "실행을 하면 아무런 화면도 나오지 않아"
- 프론트엔드 이슈 확인 (React 프로젝트 실행 필요)

**사용자**: "기본 메뉴가 보이지 않아"
- MenuService 로직 개선
- 계층형 메뉴 구조 재귀 처리 로직 수정

**사용자**: "로그에 한글이 깨지는 현상 수정해줘"
- 한글 인코딩 문제 전면 해결
- `build.gradle`: JVM 인코딩 인자 추가
- `application.yaml`: 서블릿 및 로깅 인코딩 설정
- `logback-spring.xml`: 파일 생성 및 UTF-8 인코딩 설정

### 최적화 단계

**사용자**: "200 응답 외에 나머지 오류 응답들은 공통으로 뺄 순 없어 API 마다 설정을 적용할 필욘 없을듯"
- `OperationCustomizer`를 사용한 전역 API 응답 설정
- 모든 컨트롤러에서 `@CommonApiResponses` 어노테이션 제거
- 코드 중복 제거 및 유지보수성 향상

### 대화 패턴 분석

1. **점진적 개발 접근**
   - 작은 기능부터 시작 → 확장
   - Mock 데이터 → 실제 DB

2. **문제 해결 방식**
   - 에러 메시지 기반 디버깅
   - 단계별 문제 해결
   - 컨텍스트 정보 활용

3. **효율적인 소통**
   - 명확한 요구사항 전달
   - 즉시 피드백 제공
   - 문제 발생 시 빠른 해결

4. **코드 품질 관리**
   - 일관된 패턴 유지
   - 중복 코드 제거
   - 전역 설정 활용

## 참고사항

- 모든 의존성은 안정적인 버전 사용
- 개발 환경에서는 H2 인메모리 DB 사용
- 프로덕션 환경에서는 실제 데이터베이스로 전환 필요

